# This file is managed by Puppet!

<% if scope.lookupvar("ssl") != "false" -%>
<VirtualHost *:80>
	ServerName <%= scope.lookupvar("title") %>
<% if scope.lookupvar("aliases").length > 0 -%>
	ServerAlias <%= scope.lookupvar("aliases").join(" ") %>
<% end -%>
	ServerAdmin root@wikimedia.org

	DocumentRoot <%= scope.lookupvar("docroot") %>
	<Directory <%= scope.lookupvar("docroot") %> >
		Options Indexes FollowSymLinks MultiViews
		AllowOverride None
		Order allow,deny
		allow from all
	</Directory>

	ErrorLog /var/log/apache2/error.log
	# Possible values include: debug, info, notice, warn, error, crit,
	# alert, emerg.
	LogLevel warn

	CustomLog /var/log/apache2/access.log combined
	ServerSignature On
	
<% scope.lookupvar("includes").each do |include| -%>
	Include <%= include %>
<% end -%>
</VirtualHost>
<% end -%>

<% if ["true", "only", "redirected"].include?(scope.lookupvar("ssl")) -%>
<VirtualHost *:443>
	ServerName <%= scope.lookupvar("title") %>
	<% if scope.lookupvar("aliases").length > 0 -%>
		ServerAlias <%= scope.lookupvar("aliases").join(" ") %>
	<% end -%>
	ServerAdmin root@wikimedia.org

	SSLEngine on
	SSLCertificateFile <%= scope.lookupvar("certfile") %>
	SSLCertificateKeyFile <%= scope.lookupvar("certkey") %>

	DocumentRoot <%= scope.lookupvar("docroot") %>
	<Directory <%= scope.lookupvar("docroot") %> >
		Options Indexes FollowSymLinks MultiViews
		AllowOverride None
		Order allow,deny
		allow from all
	</Directory>

	ErrorLog /var/log/apache2/error.log
	# Possible values include: debug, info, notice, warn, error, crit,
	# alert, emerg.
	LogLevel warn

	CustomLog /var/log/apache2/access.log combined
	ServerSignature On

	<% scope.lookupvar("includes").each do |include| -%>
		Include <%= include %>
	<% end -%>
</VirtualHost>
<% end -%>


# vim: filetype=apache