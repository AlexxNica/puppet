#!/bin/bash

REPOS=$1
TXN=$2

( cd /etc/puppet/manifests; svn up; cd /etc/puppet/files; svn up; cd /var/lib/puppet/templates; svn up; touch /etc/puppet/manifests/site.pp )

# 20110817 dzahn removed --with-diff option temp. because of security issues, see mail thread about this change
# 20110826 dzahn - added --with-diff again, since now all private data should have been moved to private by Ryan

/usr/bin/svnnotify		\
    --repos-path    "$REPOS"		\
    --revision      "$TXN"		\
    --subject-cx			\
    --handler       HTML::ColorDiff	\
    --with-diff				\
    --to            ops@wikimedia.org	\
    --from          svn@sockpuppet.wikimedia.org \
